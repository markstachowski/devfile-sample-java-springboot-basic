/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'gg.war'
    id 'java'
    id 'maven-publish'
    id 'jacoco'
    id 'org.springframework.boot' version '2.6.3'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    id "com.github.node-gradle.node" version "3.1.1"
}

repositories {
    mavenLocal()
    mavenCentral()
    maven {
        url = uri('https://repo.maven.apache.org/maven2/')
    }
}

dependencies {
    // GG Dependencies
    implementation('org.globalgiving:design-system:0.1.1') {
        capabilities {
            requireCapability("org.globalgiving:design-system:springMvc")
        }
    }
    implementation('org.springframework.security:spring-security-oauth2-jose') {
        because "this has JWT code"
    }
    // Global Giving Core API
    implementation("org.globalgiving:globalgiving-core:0.1.1${project.hasProperty('github') ? '.' + ggcore : '-SNAPSHOT'}") {
        exclude group: 'org.globalgiving.lib', module: '*'
        exclude group: 'org.apache.cxf', module: '*'
    }

    // Start of Spring Gradle Dependencies
    implementation 'org.springframework.boot:spring-boot-starter:2.6.3'
    implementation 'org.springframework.boot:spring-boot-starter-web:2.6.3'
    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-actuator', version: '2.6.3'
    implementation group: 'org.springframework.boot', name: 'spring-boot-starter-security', version: '2.6.3'

    // Logback using SLF4J to Log4j12
    implementation 'ch.qos.logback:logback-classic:1.2.10'
    implementation 'net.logstash.logback:logstash-logback-encoder:7.0.1'
    implementation group: 'org.slf4j', name: 'slf4j-log4j12', version: '1.7.32'

    //Mockito Dependency
    implementation 'org.mockito:mockito-core:4.3.1'

    // Project Lombok
    implementation "org.projectlombok:lombok"
    annotationProcessor 'org.projectlombok:lombok'

    // DataDog APM
    implementation group: 'com.datadoghq', name: 'java-dogstatsd-client',
            version: '3.0.1'
    implementation group: 'com.datadoghq', name: 'dd-trace-api', version: '0.92.0'

    // Extra Dependencies
    implementation 'ognl:ognl:3.3.2'
    implementation 'org.apache.commons:commons-lang3:3.12.0'
    implementation('org.apache.struts.xwork:xwork-core') {
        //FIXME not about nto needing this is in 2.5
        because 'We add a custom OgnlStack/Factory that handles some logging; though I do not think its really needed'
        version {
            strictly '2.3.35'
        }
    }

    // Spring Devtools
    developmentOnly 'org.springframework.boot:spring-boot-devtools'

    testImplementation('org.springframework.boot:spring-boot-starter-test:2.6.3') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
    testImplementation('org.springframework.security:spring-security-test:5.5.1') {
        exclude group: 'org.springframework.boot', module: 'spring-boot-starter-logging'
    }
//    testImplementation 'org.springframework.boot:spring-boot-starter-test:2.6.3'
//    testImplementation 'org.springframework.security:spring-security-test:5.5.1'

    // OpenPojo
    testImplementation 'com.openpojo:openpojo:0.9.1'

    // GG BuildSrc
    runtimeOnly('org.globalgiving.lib:lib:1.0') {
        artifact {
            name = 'contactlistimporter-1.3.1'
            type = 'jar'
        }
        artifact {
            name = 'cos'
            type = 'jar'
        }
        artifact {
            name = 'gekmllib'
            type = 'jar'
        }
        artifact {
            name = 'gnu-regexp-1.1.4'
            type = 'jar'
        }
        artifact {
            name = 'java-getopt-1.0.11'
            type = 'jar'
        }
        artifact {
            name = 'jcommon-1.0.9'
            type = 'jar'
        }
        artifact {
            name = 'jfreechart-1.0.5'
            type = 'jar'
        }
        artifact {
            name = 'jmimemagic-0.1.0'
            type = 'jar'
        }
        artifact {
            name = 'json.1.0'
            type = 'jar'
        }
        artifact {
            name = 'recaptcha4j-0.0.7'
            type = 'jar'
        }
        artifact {
            name = 'SuperCSV-1.02'
            type = 'jar'
        }
        artifact {
            name = 'jra-1.0-alpha-4'
            type = 'jar'
        }
    }
}

group = 'org.globalgiving.staffdashboard'
version = '0.0.1-SNAPSHOT'
description = 'demo'
tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

bootBuildImage {
    imageName "globalgiving/staff-dashboard:local"
}

springBoot {
    buildInfo()
}

test {
    finalizedBy jacocoTestReport

    jacoco {
        excludes = ['org.globalgiving.staffdashboard.config.*',
                    'org.globalgiving.security.web.authentication.preauth.*',
                    'org.globalgiving.config.security.web.authentication.preauth.*',]
    }
}

jacocoTestReport {
    dependsOn test

    afterEvaluate {
        getClassDirectories().setFrom(classDirectories.files.collect {
            fileTree(dir: it,
                    exclude: ['**/org/globalgiving/staffdashboard/config/**',
                              '**/org/globalgiving/security/web/authentication/preauth/GgJwtAuthenticatedProcessingFilter.class',
                              '**/org/globalgiving/config/security/web/authentication/preauth/GlobalGivingJwtPreAuthenticationProcessingFilterConfig.class'])
        })
    }
}

apply from: 'frontend.gradle'
